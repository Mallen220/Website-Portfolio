---
title: Cart
layout: default
---

<link rel="stylesheet" href="{{ '/assets/css/cart.css' | relative_url }}" />
<script src="{{ site.baseurl }}/assets/js/cart.js"></script>

<br />
<br />

<div
  class="cart-container"
  data-origin-zip="{{ site.shipping.origin_zip | default: '10001' }}"
  data-origin-country="{{ site.shipping.origin_country | default: 'US' }}"
>
  <div class="cart-header">
    <h1><i class="fas fa-shopping-cart"></i> Your Shopping Cart</h1>
    <p>Review your items before checkout</p>
  </div>

  <div class="cart-wrapper">
    <div class="cart-items">
      <div class="cart-items-header">
        <span>Cart Items</span>
        <span><span id="item-count">0</span> items</span>
      </div>

      <div id="cart-items-container" class="cart-items-list simpleCart_items">
        <!-- Items auto-generated by JS -->
        <div class="empty-cart">
          <i class="fas fa-shopping-cart"></i>
          <h2>Your cart is empty</h2>
          <p>Looks like you haven't added any items to your cart yet</p>
          <a href="/" class="continue-shopping">Continue Shopping</a>
        </div>
      </div>
    </div>

    <div class="cart-summary">
      <div class="summary-header">Order Summary</div>

      <div class="summary-content">
        <!-- Shipping address (hidden unless any physical item) -->
        <div id="shipping-estimator" style="display: none; margin-bottom: 16px">
          <div style="font-weight: 600; margin-bottom: 8px">
            Shipping Address
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px">
            <select
              id="ship-country"
              aria-label="Country"
              style="
                padding: 10px;
                border: 1px solid var(--border-color);
                border-radius: var(--border-radius);
              "
            >
              <option value="US">United States</option>
              <option value="CA">Canada</option>
              <option value="GB">United Kingdom</option>
              <option value="AU">Australia</option>
              <option value="DE">Germany</option>
              <option value="FR">France</option>
              <option value="NL">Netherlands</option>
              <option value="JP">Japan</option>
              <option value="NZ">New Zealand</option>
              <option value="OTHER">Other</option>
            </select>
            <input
              id="ship-state"
              type="text"
              placeholder="State/Province"
              aria-label="State/Province"
              style="
                padding: 10px;
                border: 1px solid var(--border-color);
                border-radius: var(--border-radius);
              "
            />
            <input
              id="ship-city"
              type="text"
              placeholder="City"
              aria-label="City"
              style="
                grid-column: span 1;
                padding: 10px;
                border: 1px solid var(--border-color);
                border-radius: var(--border-radius);
              "
            />
            <input
              id="ship-zip"
              type="text"
              placeholder="ZIP / Postal Code"
              aria-label="ZIP / Postal Code"
              style="
                grid-column: span 1;
                padding: 10px;
                border: 1px solid var(--border-color);
                border-radius: var(--border-radius);
              "
            />
          </div>
          <div
            id="ship-hint"
            style="margin-top: 8px; font-size: 0.9rem; color: var(--gray-color)"
          >
            Enter your ZIP/Postal code to see an estimated shipping cost.
          </div>
        </div>

        <div class="summary-row">
          <span>Subtotal:</span>
          <span class="summary-value" id="cart-subtotal">$0.00</span>
        </div>

        <div class="summary-row">
          <span>Shipping (est.):</span>
          <span class="summary-value" id="cart-shipping">—</span>
        </div>

        <div class="summary-row">
          <span>Handling:</span>
          <span class="summary-value" id="handling-fee">$0.00</span>
        </div>

        <div class="summary-row">
          <span>Tax:</span>
          <span class="summary-value" id="cart-tax">$0.00</span>
        </div>

        <div class="summary-row total">
          <span>Total:</span>
          <span class="summary-value" id="cart-total">$0.00</span>
        </div>

        <button class="checkout-btn">
          <i class="fas fa-lock"></i> Proceed to Checkout
        </button>

        <div class="secure-payment">
          <i class="fas fa-shield-alt"></i> Secure Payment
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // ===== Shipping Estimator (no private API required) =====
  (function () {
    // Optional merchant origin from page data attributes
    const container = document.querySelector(".cart-container");
    const ORIGIN = {
      zip: (container?.dataset.originZip || "10001").trim(),
      country: (container?.dataset.originCountry || "US").trim(),
      state: container?.dataset.originState || "",
    };

    // Persist & load address
    const addrKey = "shipping_address";
    function loadAddress() {
      try {
        return JSON.parse(localStorage.getItem(addrKey)) || {};
      } catch {
        return {};
      }
    }
    function saveAddress(a) {
      localStorage.setItem(addrKey, JSON.stringify(a));
    }

    // Helpers to read your existing cart (works with your cart.js structure)
    function getCartData() {
      try {
        const raw = localStorage.getItem("simpleCart_items");
        return raw ? JSON.parse(raw) : {};
      } catch (e) {
        return {};
      }
    }
    function itemsArray() {
      return Object.values(getCartData());
    }
    function hasPhysical() {
      return itemsArray().some(
        (it) => (it.type || "").toLowerCase() === "physical",
      );
    }
    function totalWeightOz() {
      // Use item.weight_oz if present; otherwise default 12oz per unit
      return itemsArray().reduce((oz, it) => {
        const w = Number(it.weight_oz || it.weightOz || 12); // allow either key
        const q = Number(it.quantity || 1);
        return oz + (isFinite(w) ? w : 12) * (isFinite(q) ? q : 1);
      }, 0);
    }

    // Basic validity
    function isUS(country) {
      return (country || "").toUpperCase() === "US";
    }
    function validAddress(a) {
      if (!a) return false;
      if (!a.country) return false;
      if (isUS(a.country)) {
        return /^\d{5}$/.test(String(a.zip || "").trim());
      }
      // Non-US: accept at least 3 chars for postal
      return String(a.zip || "").trim().length >= 3;
    }

    // Distance band heuristic (ZIP first digit difference as a crude zone-ish factor 0..9)
    function zoneFactorUS(destZip) {
      const o = parseInt(String(ORIGIN.zip || "0")[0], 10);
      const d = parseInt(String(destZip || "0")[0], 10);
      if (isNaN(o) || isNaN(d)) return 5;
      return Math.abs(o - d); // 0..9
    }

    // Shipping estimator (tunable, API-free). Returns { cost, label }
    function estimateShipping(address) {
      const items = itemsArray();
      if (!items.length || !hasPhysical()) {
        return { cost: 0, label: "No shipping required" };
      }

      const weightOz = Math.max(1, Math.round(totalWeightOz())); // at least 1oz
      const weightLb = weightOz / 16;

      // Surcharges for AK/HI/territories (very light approximation)
      const upperState = (address.state || "").toUpperCase();
      const nonContig = ["AK", "HI", "PR", "GU", "VI", "AS", "MP"].includes(
        upperState,
      );

      if (!address || !validAddress(address)) {
        return { cost: null, label: "Enter address for estimate" };
      }

      if (isUS(address.country)) {
        const zone = zoneFactorUS(address.zip); // 0 (closest) .. 9 (furthest)
        // USPS Ground Advantage / Priority style blended heuristic
        let base, perLb, label;
        if (weightOz <= 16) {
          base = 4.0;
          perLb = 1.1;
          label = "USPS (est.)";
        } else if (weightLb <= 5) {
          base = 8.75;
          perLb = 1.35;
          label = "USPS/UPS (est.)";
        } else {
          base = 10.5;
          perLb = 1.1;
          label = "UPS Ground (est.)";
        }
        let cost = base + (Math.ceil(weightLb) - 1) * perLb + zone * 0.6;
        if (nonContig) cost += 6.0;
        return { cost: Math.max(0, Number(cost.toFixed(2))), label };
      } else {
        // International rough estimate
        const intlBase = 18.0;
        const intlPerLb = 4.5;
        let cost = intlBase + Math.ceil(weightLb) * intlPerLb;
        return { cost: Number(cost.toFixed(2)), label: "International (est.)" };
      }
    }

    // UI wiring
    const elShipBlock = document.getElementById("shipping-estimator");
    const elCountry = document.getElementById("ship-country");
    const elState = document.getElementById("ship-state");
    const elCity = document.getElementById("ship-city");
    const elZip = document.getElementById("ship-zip");
    const elShipOut = document.getElementById("cart-shipping");
    const elSubtotal = document.getElementById("cart-subtotal");
    const elTax = document.getElementById("cart-tax");
    const elTotal = document.getElementById("cart-total");
    const elItemCount = document.getElementById("item-count");

    // Override your existing totals to insert shipping estimate
    window.updateCartTotals = function () {
      const items = itemsArray();
      let subtotal = 0,
        itemCount = 0;
      items.forEach((it) => {
        const p = Number(it.price || 0);
        const q = Number(it.quantity || 1);
        subtotal += p * q;
        itemCount += q;
      });

      // Read address (persist between sessions)
      const addr = {
        country: elCountry?.value || "US",
        state: elState?.value || "",
        city: elCity?.value || "",
        zip: elZip?.value || "",
      };
      saveAddress(addr);

      // Estimate shipping
      const est = estimateShipping(addr);
      const shippingShown = est.cost == null ? "—" : `$${est.cost.toFixed(2)}`;
      if (elShipOut) elShipOut.textContent = shippingShown;

      // Simple tax example (adjust as needed)
      const taxRate = 0.08;
      const tax = subtotal * taxRate;

      // Total (if shipping unknown, treat as 0 in total but leave "—" in UI)
      const shippingForTotal = est.cost || 0;
      const grand = subtotal + tax + shippingForTotal;

      if (elItemCount) elItemCount.textContent = itemCount;
      if (elSubtotal) elSubtotal.textContent = `$${subtotal.toFixed(2)}`;
      if (elTax) elTax.textContent = `$${tax.toFixed(2)}`;
      if (elTotal) elTotal.textContent = `$${grand.toFixed(2)}`;
    };

    // Show/hide the shipping address block depending on cart contents
    // Expose globally so cart.js can call it
    window.toggleShippingUI = function () {
      const shippingEstimator = document.getElementById("shipping-estimator");
      if (!shippingEstimator) return;

      if (hasPhysical()) {
        shippingEstimator.style.display = "block";
      } else {
        shippingEstimator.style.display = "none";
      }
    };

    // Auto-load persisted address and re-calc
    function hydrateAddress() {
      const a = loadAddress();
      if (elCountry && a.country) elCountry.value = a.country;
      if (elState && a.state) elState.value = a.state;
      if (elCity && a.city) elCity.value = a.city;
      if (elZip && a.zip) elZip.value = a.zip;
    }

    // Recalculate when the user types/changes address fields
    function bindAddressListeners() {
      [elCountry, elState, elCity, elZip].forEach((el) => {
        if (!el) return;
        el.addEventListener("input", () => {
          updateCartTotals();
        });
        el.addEventListener("change", () => {
          updateCartTotals();
        });
      });
    }

    // Initial setup after your cart.js populates the DOM
    document.addEventListener("DOMContentLoaded", function () {
      toggleShippingUI();
      hydrateAddress();
      bindAddressListeners();
      // If your cart.js already calls updateCartTotals(), our override will run.
      // Otherwise, call it here to initialize.
      updateCartTotals();
    });

    // If your code regenerates the cart (e.g., add/remove items), re-evaluate UI
    window.addEventListener("storage", function (e) {
      if (e.key === "simpleCart_items") {
        toggleShippingUI();
        updateCartTotals();
      }
    });
  })();
</script>
